# This is a GNU makefile which uses GNU make extensions
# GNUmakefile is the preferred default makefile for GNU make

# We make this one program by concatenating all the file parts.  All of
# the files but one is ruby code.  The odd file is in GNU make format.
# Keeping the files separate makes editing this program much easier.  With
# all the files concatenated editing them is difficult, editing the GNU
# make part of the program file in ruby editor mode especially sucks,
# not to mention, the concatenated full program is kind of long.


# We had fun generating one randomly generated line in each build.
# Why? Because we can.

SHELL = /bin/bash

warn_0 = If you're stupid, go ahead and edit it.
warn_1 = Please do not edit this file.
warn_2 = Enough said.
warn_3 = That means if you edit this file you may be wasting time.
warn_4 = Not that there's anything wrong with that.
warn_5 = So look but don't touch.
warn_6 = Get the source at https://github.com/lanceman2/quickbuild.git
warn_7 = I like eggs.
warn_8 = Edit the source and not this file.
warn_9 = And that's all I have to say about that.

warn = $(warn_$(shell echo -n $${RANDOM:1:1}))


quickbuild: qb_version.rb qb_package_class.rb qb_if_program.rb qb_main_program.rb\
 qb_END_section.rb qb_make.make
	echo "#!/usr/bin/ruby -w" > $@
	echo "################################################################" >> $@
	echo "# THIS IS A GENERATED FILE" >> $@
	echo "# $(warn)" >> $@
	echo "################################################################" >> $@
	echo >> $@
	cat $^ >> $@
	chmod 755 $@

README.html: %.html: %.md
	marked $< > $@

clean distclean:
	rm -f quickbuild quickbuild.tar.bz2 README.html
	$(MAKE) -C examples/ distclean

dist: quickbuild qb_php_compile
	rm -f quickbuild.tar.bz2
	tar -cvjf quickbuild.tar.bz2 quickbuild qb_php_compile

ifdef bindir
install: quickbuild
	mkdir -p $(bindir)
	cp quickbuild qb_php_compile marked $(bindir) 
else
install:
	@echo "Install it where?  Try something like:"
	@echo
	@echo "    $(MAKE) bindir=BINDIR install"
	@echo
	@echo "Where BINDIR is the path to a directory."
endif

